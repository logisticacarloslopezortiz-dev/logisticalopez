
                        <!DOCTYPE html>
                        <html lang="en">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <style>
                body {
                  background-color: white; /* Ensure the iframe has a white background */
                }
    
                
              </style>
                        </head>
                        <body>
                            <div id="assignedOrdersContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 2xl:grid-cols-4 gap-4 sm:gap-6 mb-8 w-full">

<div id="requestsTableContainer" class="hidden md:block bg-white rounded-lg shadow-md overflow-hidden">


    
              <script>
                              // ✅ MEJORA: Toggle de sidebar en móvil y escritorio
function setupSidebarToggle() {
  const sidebar = document.getElementById('collabSidebar');
  const overlay = document.getElementById('sidebarOverlay');
  const mobileBtn = document.getElementById('mobileMenuBtn');
  const desktopBtn = document.getElementById('desktopSidebarToggle');
  const mainContent = document.getElementById('mainContent');

  if (!sidebar || !overlay || !mobileBtn || !mainContent) return;

  const closeSidebar = () => {
    sidebar.classList.add('-translate-x-full');
    overlay.classList.add('hidden');
    localStorage.setItem('sidebarCollapsed', 'true');
    mainContent.classList.remove('md:ml-72');
    if (desktopBtn) {
      desktopBtn.querySelector('i').setAttribute('data-lucide', 'panel-left-close');
    }
  };

  const openSidebar = () => {
    sidebar.classList.remove('-translate-x-full');
    overlay.classList.remove('hidden');
    localStorage.setItem('sidebarCollapsed', 'false');
    mainContent.classList.add('md:ml-72');
    if (desktopBtn) {
      desktopBtn.querySelector('i').setAttribute('data-lucide', 'panel-right-close');
    }
  };

  // Mobile
  mobileBtn.addEventListener('click', () => {
    sidebar.classList.contains('-translate-x-full') ? openSidebar() : closeSidebar();
  });
  overlay.addEventListener('click', closeSidebar);

  // Desktop
  if (desktopBtn) {
    desktopBtn.addEventListener('click', () => {
      if (sidebar.classList.contains('-translate-x-full')) {
        openSidebar();
      } else {
        closeSidebar();
      }
      lucide.createIcons(); // Actualizar ícono
      setTimeout(() => activeJobMap?.invalidateSize(), 350);
    });
  }

  // Estado persistente
  if (localStorage.getItem('sidebarCollapsed') === 'true') {
    closeSidebar();
  } else {
    openSidebar();
  }
}

function renderDesktopAssignedCards(orders) {
  const container = document.getElementById('assignedOrdersContainer');
  if (!container) return;

  const myId = state.collabSession?.user?.id;
  const assigned = (orders || []).filter(o => 
    o.assigned_to === myId && o.status !== 'Completado'
  );

  if (assigned.length === 0) {
    container.classList.add('hidden');
    return;
  }

  container.classList.remove('hidden');

  container.innerHTML = assigned.map(o => {
    const statusKey = o.last_collab_status || (o.status === 'En proceso' ? 'en_camino_recoger' : o.status);
    const status = STATUS_MAP[statusKey] || { label: statusKey, badge: 'bg-gray-100 text-gray-800' };

    return `
      <div class="order-card bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 cursor-pointer"
           onclick="openAcceptModal({
             id: ${o.id},
             name: '${o.name.replace(/'/g, "\\'")}',
             phone: '${o.phone}',
             service: '${(o.service || '').replace(/'/g, "\\'")}',
             vehicle: '${(o.vehicle || '').replace(/'/g, "\\'")}',
             pickup: '${(o.pickup || '').replace(/'/g, "\\'")}',
             delivery: '${(o.delivery || '').replace(/'/g, "\\'")}',
             date: '${o.date}',
             time: '${o.time}'
           })">
        <div class="p-4">
          <!-- Encabezado con ID y estado -->
          <div class="flex justify-between items-start mb-3">
            <span class="px-2.5 py-1 text-xs font-bold rounded bg-blue-100 text-blue-800">ID: ${o.id}</span>
            <span class="px-2 py-1 text-xs font-semibold rounded-full ${status.badge}">${status.label}</span>
          </div>

          <!-- Cliente -->
          <h3 class="font-semibold text-gray-900 text-base mb-1 truncate">${o.name}</h3>
          <p class="text-sm text-gray-600 mb-3">${o.phone}</p>

          <!-- Servicio -->
          <div class="mb-2">
            <p class="text-sm font-medium text-gray-800">${o.service || '—'}</p>
            ${o.vehicle ? `<p class="text-xs text-gray-500">${o.vehicle}</p>` : ''}
          </div>

          <!-- Ruta -->
          <div class="text-xs text-gray-600 mb-2">
            <span class="font-medium">Ruta:</span>
            <span class="block truncate" title="${o.pickup} → ${o.delivery}">
              ${o.pickup} → ${o.delivery}
            </span>
          </div>

          <!-- Fecha/Hora -->
          <div class="text-xs text-gray-600">
            <span class="font-medium">Fecha:</span> ${o.date} • ${o.time}
          </div>
        </div>
      </div>
    `;
  }).join('');

  if (window.lucide) lucide.createIcons();
}


              </script>
                        </body>
                        </html>
                    
