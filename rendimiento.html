<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Rendimiento del Colaborador</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <link rel="stylesheet" href="css/admin-panel-styles.css">
  <style>
    body{background:linear-gradient(180deg,#f3f6f8 0%,#eef2f5 100%)}
    :root{--azul:#0C375D;--turquesa:#117D8B;--azul-claro:#3B82F6;--blanco:#ffffff}
    .stat-card{color:#fff}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:0.75rem}
    aside#sidebar{background:var(--azul)}
    aside#sidebar .sidebar-header{background:var(--azul) !important}
    aside#sidebar nav{background:var(--azul)}
    aside#sidebar nav a{color:#fff}
    aside#sidebar nav a:hover{background:#facc15;color:#0C375D}
    aside#sidebar nav a.active{background:#facc15;color:#0C375D}
    .sidebar-footer{background:var(--azul) !important}
    .sidebar-footer button{background:#0C375D;color:#fff}
    .sidebar-footer button:hover{background:#facc15;color:#0C375D}
  </style>
</head>
<body class="bg-gray-100">

  <button id="mobileSidebarToggle" class="fixed top-4 left-4 z-40 p-2 rounded-md bg-white shadow-md md:hidden">
    <i data-lucide="menu" class="w-6 h-6 text-gray-800"></i>
  </button>
  <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>

  <aside id="sidebar" class="fixed top-0 left-0 h-screen w-64 z-30 flex flex-col transition-all duration-300 ease-in-out transform -translate-x-full md:translate-x-0">
    <div class="sidebar-header flex items-center gap-3 py-6 px-4" style="background:var(--azul)">
      <img src="img/1vertical.png" alt="LLO" class="sidebar-logo w-11 h-11 object-contain rounded-xl shadow-lg bg-white border-2 border-white">
      <div class="flex flex-col">
        <h2 class="text-xl font-bold text-white sidebar-text">Rendimiento</h2>
        <div class="text-xs text-white/80 sidebar-text">
          <span id="sidebarCollabName">—</span> • <span id="sidebarCollabMatricula">—</span>
        </div>
      </div>
    </div>
    <nav class="flex-1 flex flex-col gap-2 py-4 px-4">
      <a href="panel-colaborador.html" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50"><i data-lucide="user" class="w-5 h-5"></i> <span class="sidebar-text">Mi Panel</span></a>
      <a href="rendimiento.html" class="flex items-center gap-3 px-4 py-3 rounded-lg active"><i data-lucide="bar-chart-3" class="w-5 h-5"></i> <span class="sidebar-text">Rendimiento</span></a>
      <button id="sidebar-toggle" class="w-full flex items-center justify-center gap-3 px-4 py-3 rounded-lg text-sm border mt-2">
        <i id="sidebar-toggle-icon" data-lucide="panel-left-close" class="w-5 h-5"></i>
        <span class="sidebar-text font-medium">Colapsar</span>
      </button>
      <button id="logout-button" class="w-full flex items-center justify-center gap-3 px-4 py-3 rounded-lg mt-2 text-sm border">
        <i data-lucide="log-out" class="w-5 h-5"></i>
        <span class="sidebar-text font-medium">Cerrar Sesión</span>
      </button>
    </nav>
  </aside>

  <main id="main-content" class="main-content p-8 space-y-8 md:ml-64">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 mb-1">Rendimiento</h1>
        <p class="text-gray-600">Tus métricas de trabajo y progreso.</p>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <div class="stat-card p-6 rounded-xl shadow-lg" style="background:var(--turquesa)">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium opacity-80">Órdenes Asignadas</p>
            <p class="text-3xl font-bold" id="metricAssigned">0</p>
          </div>
          <i data-lucide="clipboard-list" class="w-8 h-8 opacity-60"></i>
        </div>
      </div>
      <div class="stat-card p-6 rounded-xl shadow-lg" style="background:var(--azul)">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium opacity-80">Órdenes Completadas</p>
            <p class="text-3xl font-bold" id="metricCompleted">0</p>
          </div>
          <i data-lucide="check-circle" class="w-8 h-8 opacity-60"></i>
        </div>
      </div>
      <div class="stat-card p-6 rounded-xl shadow-lg" style="background:var(--azul-claro)">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm font-medium opacity-80">Tiempo Promedio</p>
            <p class="text-3xl font-bold" id="metricAvgTime">0h</p>
          </div>
          <i data-lucide="timer" class="w-8 h-8 opacity-60"></i>
        </div>
      </div>
    </div>

    <section class="card p-6">
      <h2 class="text-xl font-bold flex items-center gap-3 mb-4" style="color:var(--azul)">
        <span class="bg-blue-100 p-2 rounded-lg"><i data-lucide="bar-chart" class="w-5 h-5 text-blue-600"></i></span>
        Órdenes realizadas y distribución
      </h2>
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="col-span-1 h-72 bg-white rounded-lg border"><canvas id="chartWeekly"></canvas></div>
        <div class="col-span-1 h-72 bg-white rounded-lg border"><canvas id="chartServices"></canvas></div>
        <div class="col-span-1 h-72 bg-white rounded-lg border"><canvas id="chartVehicles"></canvas></div>
      </div>
    </section>

    <section class="card p-6">
      <h2 class="text-xl font-bold flex items-center gap-3 mb-4" style="color:var(--turquesa)">
        <span class="bg-blue-100 p-2 rounded-lg"><i data-lucide="table" class="w-5 h-5 text-blue-600"></i></span>
        Historial y Rendimiento
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <div class="stat-card p-6 rounded-xl shadow-lg" style="background:var(--turquesa)">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium opacity-80">Este Mes</p>
              <p class="text-3xl font-bold" id="myMonthEarnings">$0.00</p>
            </div>
            <i data-lucide="calendar" class="w-8 h-8 opacity-60"></i>
          </div>
        </div>
        <div class="stat-card p-6 rounded-xl shadow-lg" style="background:var(--azul)">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium opacity-80">Total Acumulado</p>
              <p class="text-3xl font-bold" id="myTotalEarnings">$0.00</p>
            </div>
            <i data-lucide="wallet" class="w-8 h-8 opacity-60"></i>
          </div>
        </div>
        <div class="stat-card p-6 rounded-xl shadow-lg" style="background:var(--azul-claro)">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium opacity-80">Mi % Comisión</p>
              <p class="text-3xl font-bold" id="myCommissionPct">0%</p>
            </div>
            <i data-lucide="percent" class="w-8 h-8 opacity-60"></i>
          </div>
        </div>
        <div class="stat-card p-6 rounded-xl shadow-lg" style="background:var(--azul)">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium opacity-80">Calificación Promedio</p>
              <p class="text-3xl font-bold" id="myAvgRating">—</p>
            </div>
            <i data-lucide="star" class="w-8 h-8 opacity-60"></i>
          </div>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full">
          <thead>
            <tr>
              <th class="table-header">ID</th>
              <th class="table-header">Cliente</th>
              <th class="table-header">Servicio</th>
              <th class="table-header">Fecha</th>
              <th class="table-header">Comisión</th>
              <th class="table-header">Calificación</th>
              <th class="table-header">Acciones</th>
            </tr>
          </thead>
          <tbody id="unifiedTable" class="divide-y divide-gray-100"></tbody>
        </table>
      </div>
      <div id="rendPagination" class="flex items-center justify-between mt-4">
        <div class="text-sm text-gray-600">Mostrando <span id="rendShowingRange">0–0</span> de <span id="rendTotalCount">0</span></div>
        <div class="flex items-center gap-2" aria-label="Paginación">
          <button id="rendFirst" class="px-3 py-2 bg-gray-100 rounded hover:bg-gray-200 text-sm">Primera</button>
          <button id="rendPrev" class="px-3 py-2 bg-gray-100 rounded hover:bg-gray-200 text-sm">Anterior</button>
          <div id="rendPages" class="flex items-center gap-1"></div>
          <button id="rendNext" class="px-3 py-2 bg-gray-100 rounded hover:bg-gray-200 text-sm">Siguiente</button>
          <button id="rendLast" class="px-3 py-2 bg-gray-100 rounded hover:bg-gray-200 text-sm">Última</button>
        </div>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/supabase-config.js"></script>
  <script src="js/sidebar.js"></script>
  <script src="js/rendimiento.js"></script>
  <div id="customerCommentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl w-full max-w-xl overflow-hidden">
      <div class="flex items-center justify-between p-4 border-b">
        <h3 class="font-bold text-lg">Comentario del Cliente</h3>
        <button id="closeCustomerComment" class="p-2 rounded hover:bg-gray-100"><i data-lucide="x" class="w-5 h-5"></i></button>
      </div>
      <div id="customerCommentBody" class="p-4 text-sm text-gray-700"></div>
    </div>
  </div>
</body>
</html>
